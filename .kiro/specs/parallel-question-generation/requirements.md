# Requirements Document

## Introduction

This feature addresses the timeout issues in question generation by implementing a three-phase parallel processing system. The system will generate one question per API call to eliminate timeout risks. Phase 1: User fills out an enhanced questionnaire with optional topic/subtopic preferences. Phase 2: A master orchestrator API call analyzes the requirements and creates a detailed question plan specifying the topic and focus for each individual question. Phase 3: Individual parallel API calls generate each question based on the master plan, ensuring no single call exceeds time limits.

## Requirements

### Requirement 1

**User Story:** As a user creating a question paper, I want to specify my topic and subtopic preferences in the questionnaire, so that the generated questions align with my specific focus areas.

#### Acceptance Criteria

1. WHEN the user accesses the question form THEN the system SHALL display an optional "Topic/Subtopic Preferences" text input field
2. WHEN the user enters topic preferences THEN the system SHALL accept free-form text describing desired focus areas (e.g., "magnetism, thermodynamics, quantum mechanics")
3. WHEN the user leaves the topic field empty THEN the system SHALL generate questions based on the selected subject and difficulty level only
4. WHEN the user submits the form THEN the system SHALL validate that all required fields are completed and store the topic preferences for use in question planning

### Requirement 2

**User Story:** As a user generating questions, I want the system to create a master plan for my question paper, so that each question has a specific topic focus and the overall paper is well-structured.

#### Acceptance Criteria

1. WHEN the user submits a question generation request THEN the system SHALL make a master orchestrator API call first
2. WHEN the master orchestrator runs THEN it SHALL analyze the subject, difficulty, question count, and topic preferences
3. WHEN creating the question plan THEN the system SHALL assign a specific topic/subtopic focus to each question number
4. WHEN topic preferences are provided THEN the master orchestrator SHALL prioritize those topics while ensuring variety
5. WHEN no topic preferences are given THEN the master orchestrator SHALL create a balanced distribution across the subject area
6. WHEN the master plan is complete THEN it SHALL return a structured list with question number, assigned topic, and specific focus for each question

### Requirement 3

**User Story:** As a user, I want each question to be generated by a separate API call, so that complex questions don't cause timeouts and I can see progress as each question completes.

#### Acceptance Criteria

1. WHEN the master plan is ready THEN the system SHALL initiate individual API calls for each question
2. WHEN generating each question THEN the system SHALL use a dedicated API call with the specific topic focus from the master plan
3. WHEN each question API call executes THEN it SHALL receive the overall paper context (subject, difficulty) plus the specific topic assignment
4. WHEN a question generation call completes THEN the system SHALL update the progress indicator
5. WHEN all individual question calls complete THEN the system SHALL combine the results into the final question paper

### Requirement 4

**User Story:** As a user, I want to see real-time progress as my questions are being generated, so that I know the system is working and can track completion status.

#### Acceptance Criteria

1. WHEN question generation starts THEN the system SHALL display a progress indicator showing "Creating question plan..."
2. WHEN the master plan completes THEN the system SHALL show "Generating X questions..." with a progress bar
3. WHEN each individual question completes THEN the progress bar SHALL update to show current completion count
4. WHEN a question fails THEN the system SHALL display the specific question number that failed
5. WHEN all questions complete THEN the system SHALL display "Complete!" and show the final question paper

### Requirement 5

**User Story:** As a system administrator, I want the parallel generation system to handle individual question failures gracefully, so that one failed question doesn't break the entire paper generation.

#### Acceptance Criteria

1. WHEN an individual question API call fails THEN the system SHALL retry that specific question up to 2 times
2. WHEN a question fails permanently THEN the system SHALL continue generating other questions
3. WHEN some questions fail THEN the system SHALL return the successfully generated questions with clear indication of which questions failed
4. WHEN the master orchestrator fails THEN the system SHALL fall back to the original sequential generation method
5. WHEN all individual question calls fail THEN the system SHALL display an error message and suggest trying again with fewer questions

### Requirement 6

**User Story:** As a user, I want the individual questions to maintain consistency with the overall paper theme, so that the final result feels cohesive despite being generated separately.

#### Acceptance Criteria

1. WHEN generating each individual question THEN the system SHALL receive context about the overall paper (subject, difficulty, total question count)
2. WHEN creating question-specific prompts THEN each SHALL include the assigned topic from the master plan
3. WHEN a question is generated THEN it SHALL maintain the specified difficulty level and format requirements
4. WHEN combining final results THEN the system SHALL preserve the question order as planned by the master orchestrator
5. WHEN displaying the final paper THEN questions SHALL flow logically according to the master plan's topic progression